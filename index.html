<script>
  // ... (tus variables y funciones anteriores se mantienen igual)

  async function hacerRetiro(monto) {
    mostrarMensaje("Procesando retiro...", "#ff0");
    try {
      const res = await fetch("https://teo-p.onrender.com/retiro", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          "x-api-key": "secret_token_123"
        },
        body: JSON.stringify({
          currency: "BTC",
          amount: monto,
          address: wallet,
          memo: ""
        })
      });

      const text = await res.text();  // Captura texto sin asumir que es JSON
      console.log("Respuesta cruda del servidor:", text);

      if (!text) {
        mostrarError("El servidor no devolvió respuesta.");
        return;
      }

      let data;
      try {
        data = JSON.parse(text);
      } catch (e) {
        mostrarError("Respuesta inválida del servidor.");
        console.error("Error al convertir JSON:", e);
        return;
      }

      if (res.ok && data.success) {
        mostrarResultado(data);
        guardarHistorial(data);
        mostrarHistorial();
      } else {
        mostrarError(data.detail || data.message || "Error desconocido.");
      }
    } catch (err) {
      mostrarError("Error de red: " + err.message);
    }
  }

  // ... (todo el resto del código sigue igual)
</script>
