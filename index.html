<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>BTCMovil Retiro</title>
<style>
  body { font-family: Arial, sans-serif; background: #121212; color: white; padding: 20px; }
  label { display: block; margin-top: 10px; }
  input, button { padding: 8px; width: 100%; max-width: 400px; margin-top: 5px; border-radius: 5px; border: none; }
  button { background: #fcd703; color: #121212; font-weight: bold; cursor: pointer; }
  button:hover { background: #d4b800; }
  #saldo { margin-top: 20px; font-weight: bold; }
</style>
</head>
<body>

<h1>Solicitar Retiro BTC / USDT</h1>

<div>
  <label for="currency">Moneda (BTC o USDT):</label>
  <input type="text" id="currency" value="BTC" />
  
  <label for="amount">Monto a retirar:</label>
  <input type="number" id="amount" step="any" min="0" />
  
  <label for="address">Direcci√≥n de wallet:</label>
  <input type="text" id="address" />
  
  <label for="memo">Memo (opcional):</label>
  <input type="text" id="memo" />
  
  <button onclick="solicitarRetiro()">Solicitar Retiro</button>
  
  <p id="mensaje"></p>
</div>

<div id="saldo"></div>

<script>
  const API_BASE = 'https://TU_SERVICIO.onrender.com'; // Cambia por la URL real de tu backend

  async function consultarSaldo() {
    const currency = document.getElementById('currency').value.toUpperCase();
    if (!currency) return;
    try {
      const res = await fetch(\`\${API_BASE}/saldo/\${currency}\`);
      const data = await res.json();
      document.getElementById('saldo').innerText = \`Saldo disponible en \${currency}: \${data.balance}\`;
    } catch (e) {
      document.getElementById('saldo').innerText = 'Error al consultar saldo.';
    }
  }

  document.getElementById('currency').addEventListener('change', consultarSaldo);
  window.onload = consultarSaldo;

  async function solicitarRetiro() {
    const currency = document.getElementById('currency').value.trim().toUpperCase();
    const amount = parseFloat(document.getElementById('amount').value);
    const address = document.getElementById('address').value.trim();
    const memo = document.getElementById('memo').value.trim() || null;

    if (!currency || !amount || !address) {
      document.getElementById('mensaje').innerText = 'Por favor completa todos los campos obligatorios.';
      return;
    }

    document.getElementById('mensaje').innerText = 'Enviando solicitud...';

    try {
      const response = await fetch(\`\${API_BASE}/retiro\`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ currency, amount, address, memo })
      });
      const data = await response.json();
      if (data.success) {
        document.getElementById('mensaje').innerText = 'Retiro solicitado correctamente. ID: ' + data.withdrawId;
        consultarSaldo();
      } else {
        document.getElementById('mensaje').innerText = 'Error: ' + (data.detail || 'No se pudo completar la solicitud.');
      }
    } catch (error) {
      document.getElementById('mensaje').innerText = 'Error en la solicitud: ' + error.message;
    }
  }
</script>

</body>
</html>
